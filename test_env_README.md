# Тесты для RogueEnv

Файл `test_env.py` содержит комплексные тесты для класса `RogueEnv` - RL-среды для игры Rogue, совместимой с Ray RLlib.

## Описание тестов

### Основные тесты

1. **test_init()** - Проверяет правильную инициализацию среды:
   - Корректные пространства действий и наблюдений
   - Установка параметра max_steps
   - Создание интерфейса игры

2. **test_non_empty_method()** - Тестирует метод подсчета непустых символов:
   - Подсчет символов, отличных от пробелов
   - Исключение последней строки состояния
   - Обработка пустого состояния

3. **test_reset()** - Проверяет сброс среды:
   - Вызов restart() интерфейса
   - Сброс счетчика шагов
   - Установка начального счета
   - Возврат правильного наблюдения

### Тесты действий

4. **test_step_valid_actions()** - Тестирует выполнение валидных действий (0-3):
   - Правильность структуры возвращаемых данных
   - Типы возвращаемых значений
   - Содержимое словаря info

5. **test_step_invalid_action()** - Проверяет обработку невалидных действий:
   - Генерация ValueError для действий вне диапазона 0-3

6. **test_step_action_mapping()** - Тестирует маппинг действий на клавиши:
   - 0 → "h" (влево)
   - 1 → "j" (вниз)  
   - 2 → "k" (вверх)
   - 3 → "l" (вправо)

### Тесты логики игры

7. **test_step_done_condition()** - Проверяет условие завершения эпизода:
   - Правильная работа счетчика шагов
   - Установка флага done при достижении max_steps

8. **test_step_count_increment()** - Тестирует инкремент счетчика шагов:
   - Увеличение curr_step при каждом действии
   - Соответствие значения в info["steps"]

### Тесты отображения

9. **test_render()** - Проверяет метод отображения состояния:
   - Правильный вывод строк состояния через print

10. **test_render_with_mode()** - Тестирует render с параметром mode

### Дополнительные тесты

11. **test_metadata()** - Проверяет метаданные класса
12. **test_gym_env_inheritance()** - Убеждается в наследовании от gym.Env
13. **test_non_empty_empty_state()** - Тестирует _non_empty с пустым состоянием

## Запуск тестов

Для запуска всех тестов выполните:

```bash
cd /home/shkiper/dm
python test_env.py
```

Или через unittest:

```bash
python -m unittest test_env.py -v
```

## Моки и заглушки

Тесты используют unittest.mock для создания заглушек:
- `RogueInterface` - основной интерфейс игры замокан полностью
- `print` - перехватывается для тестирования render()

Это позволяет тестировать логику класса без фактического запуска игры Rogue и tmux.

## Покрытие

Тесты покрывают:
- ✅ Инициализацию класса
- ✅ Все публичные методы (reset, step, render)
- ✅ Приватный метод _non_empty
- ✅ Обработку ошибок
- ✅ Граничные случаи
- ✅ Маппинг действий
- ✅ Логику завершения эпизода

Все тесты проходят успешно (13/13).
